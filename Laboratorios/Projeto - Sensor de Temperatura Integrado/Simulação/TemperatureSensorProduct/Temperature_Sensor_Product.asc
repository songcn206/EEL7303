Version 4
SHEET 1 4048 2852
WIRE 1008 -48 848 -48
WIRE -1328 -32 -1456 -32
WIRE -1200 -32 -1328 -32
WIRE 1504 -32 1344 -32
WIRE 1712 -32 1504 -32
WIRE -1456 0 -1456 -32
WIRE -1200 0 -1200 -32
WIRE -192 0 -352 0
WIRE 848 16 848 -48
WIRE 880 16 848 16
WIRE 1344 16 1344 -32
WIRE 1712 16 1712 -32
WIRE -2464 32 -2496 32
WIRE 128 32 128 16
WIRE 240 32 240 16
WIRE 368 32 368 16
WIRE 1008 32 1008 -48
WIRE 1008 32 944 32
WIRE 1024 32 1008 32
WIRE -2336 48 -2400 48
WIRE 880 48 800 48
WIRE -2464 64 -2496 64
WIRE -1328 64 -1328 -32
WIRE -352 64 -352 0
WIRE -320 64 -352 64
WIRE -784 80 -784 64
WIRE -192 80 -192 0
WIRE -192 80 -256 80
WIRE -176 80 -192 80
WIRE -832 96 -864 96
WIRE -320 96 -352 96
WIRE 1552 112 1424 112
WIRE 1632 112 1552 112
WIRE -832 144 -864 144
WIRE -2496 160 -2496 64
WIRE -2432 160 -2496 160
WIRE -2336 160 -2336 48
WIRE -2336 160 -2352 160
WIRE -2256 160 -2336 160
WIRE -2128 160 -2176 160
WIRE -2096 160 -2128 160
WIRE -1920 160 -2016 160
WIRE -1552 160 -1600 160
WIRE -1456 160 -1456 80
WIRE -1456 160 -1488 160
WIRE -1344 160 -1344 128
WIRE -1344 160 -1456 160
WIRE -1312 160 -1312 128
WIRE -1200 160 -1200 80
WIRE -1200 160 -1312 160
WIRE -2496 176 -2496 160
WIRE -1600 176 -1600 160
WIRE 1344 176 1344 160
WIRE 1504 176 1504 -32
WIRE 1504 176 1344 176
WIRE 1712 176 1712 160
WIRE 1712 176 1504 176
WIRE -1200 208 -1200 160
WIRE -864 208 -864 144
WIRE -864 208 -896 208
WIRE -784 208 -784 160
WIRE -704 208 -784 208
WIRE -576 208 -624 208
WIRE -544 208 -576 208
WIRE -384 208 -480 208
WIRE -368 208 -384 208
WIRE 1344 208 1344 176
WIRE 1712 208 1712 176
WIRE 208 224 176 224
WIRE -2128 240 -2128 160
WIRE -2032 240 -2128 240
WIRE -896 240 -896 208
WIRE 208 240 176 240
WIRE 640 240 608 240
WIRE -1920 256 -1920 160
WIRE -1920 256 -1968 256
WIRE -1888 256 -1920 256
WIRE -784 256 -784 208
WIRE 208 256 176 256
WIRE -2496 272 -2496 256
WIRE -2432 272 -2496 272
WIRE -2336 272 -2352 272
WIRE -2256 272 -2336 272
WIRE -2128 272 -2176 272
WIRE -2032 272 -2128 272
WIRE -864 272 -864 208
WIRE -832 272 -864 272
WIRE 208 272 176 272
WIRE 640 272 608 272
WIRE -2128 288 -2128 272
WIRE -208 288 -224 288
WIRE 208 288 176 288
WIRE 912 288 896 288
WIRE -1456 304 -1456 160
WIRE -1360 304 -1456 304
WIRE -1200 304 -1200 288
WIRE -1200 304 -1296 304
WIRE -576 304 -576 208
WIRE -496 304 -576 304
WIRE -128 304 -144 304
WIRE -96 304 -128 304
WIRE 0 304 0 288
WIRE 0 304 -16 304
WIRE 1552 304 1552 112
WIRE 1552 304 1424 304
WIRE 1632 304 1552 304
WIRE -832 320 -864 320
WIRE -384 320 -384 208
WIRE -384 320 -432 320
WIRE -352 320 -384 320
WIRE -240 320 -272 320
WIRE -208 320 -240 320
WIRE 0 320 0 304
WIRE 912 320 896 320
WIRE -1456 336 -1456 304
WIRE -1200 336 -1200 304
WIRE -496 336 -528 336
WIRE 208 336 176 336
WIRE -784 352 -784 336
WIRE 208 352 176 352
WIRE 640 352 608 352
WIRE -2496 368 -2496 272
WIRE -2464 368 -2496 368
WIRE 208 368 176 368
WIRE 1344 368 1344 352
WIRE 1504 368 1504 176
WIRE 1504 368 1344 368
WIRE 1712 368 1712 352
WIRE 1712 368 1504 368
WIRE -2336 384 -2336 272
WIRE -2336 384 -2400 384
WIRE -1360 384 -1360 304
WIRE -1360 384 -1392 384
WIRE -1296 384 -1296 304
WIRE -1264 384 -1296 384
WIRE 208 384 176 384
WIRE 640 384 608 384
WIRE -2464 400 -2496 400
WIRE 208 400 176 400
WIRE 528 400 416 400
WIRE 1344 400 1344 368
WIRE 1712 400 1712 368
WIRE -240 416 -240 320
WIRE -224 416 -240 416
WIRE -128 416 -128 304
WIRE -128 416 -144 416
WIRE 0 416 0 400
WIRE -2128 432 -2128 368
WIRE 416 448 416 400
WIRE -1456 464 -1456 432
WIRE -1200 464 -1200 432
WIRE 736 464 704 464
WIRE 208 496 176 496
WIRE 336 496 272 496
WIRE 528 496 528 400
WIRE 528 496 496 496
WIRE 736 496 528 496
WIRE 816 496 800 496
WIRE 1552 496 1552 304
WIRE 1552 496 1424 496
WIRE 1632 496 1552 496
WIRE 208 528 176 528
WIRE -2464 544 -2496 544
WIRE 336 544 320 544
WIRE 560 544 512 544
WIRE -2336 560 -2400 560
WIRE 1344 560 1344 544
WIRE 1504 560 1504 368
WIRE 1504 560 1344 560
WIRE 1712 560 1712 544
WIRE 1712 560 1504 560
WIRE -2464 576 -2496 576
WIRE 1344 592 1344 560
WIRE 1712 592 1712 560
WIRE -2496 672 -2496 576
WIRE -2432 672 -2496 672
WIRE -2336 672 -2336 560
WIRE -2336 672 -2352 672
WIRE -2256 672 -2336 672
WIRE -2128 672 -2176 672
WIRE -2096 672 -2128 672
WIRE -1920 672 -2016 672
WIRE -2496 688 -2496 672
WIRE 1552 688 1552 496
WIRE 1552 688 1424 688
WIRE 1632 688 1552 688
WIRE -2128 752 -2128 672
WIRE -2032 752 -2128 752
WIRE 1344 752 1344 736
WIRE 1504 752 1504 560
WIRE 1504 752 1344 752
WIRE 1712 752 1712 736
WIRE 1712 752 1504 752
WIRE -1920 768 -1920 672
WIRE -1920 768 -1968 768
WIRE -1888 768 -1920 768
WIRE -2496 784 -2496 768
WIRE -2432 784 -2496 784
WIRE -2336 784 -2352 784
WIRE -2256 784 -2336 784
WIRE -2128 784 -2176 784
WIRE -2032 784 -2128 784
WIRE 1344 784 1344 752
WIRE 1712 784 1712 752
WIRE -2128 800 -2128 784
WIRE -1392 832 -1520 832
WIRE -1136 832 -1392 832
WIRE -880 832 -1136 832
WIRE -624 832 -880 832
WIRE -368 832 -624 832
WIRE -112 832 -368 832
WIRE 144 832 -112 832
WIRE 400 832 144 832
WIRE 656 832 400 832
WIRE 912 832 656 832
WIRE -1280 864 -1280 800
WIRE -1280 864 -1504 864
WIRE -1024 864 -1024 800
WIRE -1024 864 -1248 864
WIRE -768 864 -768 800
WIRE -768 864 -992 864
WIRE -512 864 -512 800
WIRE -512 864 -736 864
WIRE -256 864 -256 800
WIRE -256 864 -480 864
WIRE 0 864 0 800
WIRE 0 864 -224 864
WIRE 256 864 256 800
WIRE 256 864 32 864
WIRE 512 864 512 800
WIRE 512 864 288 864
WIRE 768 864 768 800
WIRE 768 864 544 864
WIRE 1024 864 1024 800
WIRE 1024 864 800 864
WIRE -2496 880 -2496 784
WIRE -2464 880 -2496 880
WIRE 1552 880 1552 688
WIRE 1552 880 1424 880
WIRE 1632 880 1552 880
WIRE -2336 896 -2336 784
WIRE -2336 896 -2400 896
WIRE -1392 896 -1392 832
WIRE -1136 896 -1136 832
WIRE -880 896 -880 832
WIRE -624 896 -624 832
WIRE -368 896 -368 832
WIRE -112 896 -112 832
WIRE 144 896 144 832
WIRE 400 896 400 832
WIRE 656 896 656 832
WIRE 912 896 912 832
WIRE 1552 896 1552 880
WIRE -2464 912 -2496 912
WIRE -2128 944 -2128 880
WIRE -1504 944 -1504 864
WIRE -1472 944 -1504 944
WIRE -1264 944 -1312 944
WIRE -1248 944 -1248 864
WIRE -1216 944 -1248 944
WIRE -1008 944 -1056 944
WIRE -992 944 -992 864
WIRE -960 944 -992 944
WIRE -752 944 -800 944
WIRE -736 944 -736 864
WIRE -704 944 -736 944
WIRE -496 944 -544 944
WIRE -480 944 -480 864
WIRE -448 944 -480 944
WIRE -240 944 -288 944
WIRE -224 944 -224 864
WIRE -192 944 -224 944
WIRE 16 944 -32 944
WIRE 32 944 32 864
WIRE 64 944 32 944
WIRE 272 944 224 944
WIRE 288 944 288 864
WIRE 320 944 288 944
WIRE 528 944 480 944
WIRE 544 944 544 864
WIRE 576 944 544 944
WIRE 784 944 736 944
WIRE 800 944 800 864
WIRE 832 944 800 944
WIRE 1344 976 1344 928
WIRE 1504 976 1504 752
WIRE 1504 976 1344 976
WIRE 1712 976 1712 928
WIRE 1712 976 1504 976
WIRE -1472 992 -1520 992
WIRE -1280 992 -1280 864
WIRE -1280 992 -1296 992
WIRE -1264 992 -1264 944
WIRE -1216 992 -1264 992
WIRE -1024 992 -1024 864
WIRE -1024 992 -1040 992
WIRE -1008 992 -1008 944
WIRE -960 992 -1008 992
WIRE -768 992 -768 864
WIRE -768 992 -784 992
WIRE -752 992 -752 944
WIRE -704 992 -752 992
WIRE -512 992 -512 864
WIRE -512 992 -528 992
WIRE -496 992 -496 944
WIRE -448 992 -496 992
WIRE -256 992 -256 864
WIRE -256 992 -272 992
WIRE -240 992 -240 944
WIRE -192 992 -240 992
WIRE 0 992 0 864
WIRE 0 992 -16 992
WIRE 16 992 16 944
WIRE 64 992 16 992
WIRE 256 992 256 864
WIRE 256 992 240 992
WIRE 272 992 272 944
WIRE 320 992 272 992
WIRE 512 992 512 864
WIRE 512 992 496 992
WIRE 528 992 528 944
WIRE 576 992 528 992
WIRE 768 992 768 864
WIRE 768 992 752 992
WIRE 784 992 784 944
WIRE 832 992 784 992
WIRE 1024 992 1024 864
WIRE 1024 992 1008 992
WIRE 1504 992 1504 976
WIRE -1392 1072 -1392 1040
WIRE -1392 1072 -1520 1072
WIRE -1136 1072 -1136 1040
WIRE -1136 1072 -1392 1072
WIRE -880 1072 -880 1040
WIRE -880 1072 -1136 1072
WIRE -624 1072 -624 1040
WIRE -624 1072 -880 1072
WIRE -368 1072 -368 1040
WIRE -368 1072 -624 1072
WIRE -112 1072 -112 1040
WIRE -112 1072 -368 1072
WIRE 144 1072 144 1040
WIRE 144 1072 -112 1072
WIRE 400 1072 400 1040
WIRE 400 1072 144 1072
WIRE 656 1072 656 1040
WIRE 656 1072 400 1072
WIRE 912 1072 912 1040
WIRE 912 1072 656 1072
FLAG -464 288 VCC
FLAG 368 112 0
FLAG 368 16 VCC
FLAG -368 208 INT_OUT
FLAG 0 288 A_COMP_OUT
FLAG -784 208 VSW
FLAG 128 112 0
FLAG 128 16 CLK
FLAG -1520 1072 0
FLAG -1280 800 BIT0
FLAG -1024 800 BIT1
FLAG -768 800 BIT2
FLAG -512 800 BIT3
FLAG -1520 832 0
FLAG 176 224 BIT0
FLAG 176 240 BIT1
FLAG 176 256 BIT2
FLAG 176 272 BIT3
FLAG 272 240 AND_AUX_1
FLAG -256 800 BIT4
FLAG 0 800 BIT5
FLAG 256 800 BIT6
FLAG 512 800 BIT7
FLAG 608 384 CLK
FLAG 704 352 COUNT_IN
FLAG 176 336 BIT5
FLAG 176 352 BIT6
FLAG 176 368 BIT7
FLAG 176 384 BIT8
FLAG 272 352 AND_AUX_2
FLAG 608 240 AND_AUX_1
FLAG 608 272 AND_AUX_2
FLAG 704 240 CTRL_IN
FLAG 416 592 0
FLAG 560 544 CTRL_PTAT
FLAG 320 544 CLK
FLAG 240 112 0
FLAG 176 496 CTRL_IN
FLAG -1520 992 COUNT_IN
FLAG -864 96 CTRL_PTAT
FLAG 800 464 CTRL_REF
FLAG 176 288 BIT4
FLAG 768 800 BIT8
FLAG 1024 800 BIT9
FLAG 176 400 BIT9
FLAG -1456 464 0
FLAG -1200 464 0
FLAG -1296 96 VCC
FLAG -1328 -32 VREF
FLAG -1200 160 PTAT+
FLAG -1200 304 PTAT-
FLAG -1456 304 CTAT
FLAG -784 64 BG_PTAT
FLAG -784 352 BG_REF
FLAG -864 320 CTRL_REF
FLAG 176 528 START
FLAG 240 16 START
FLAG -896 240 0
FLAG -2000 224 VCC
FLAG -1888 256 BG_PTAT
FLAG -2496 32 PTAT+
FLAG -2496 400 PTAT-
FLAG -2496 912 VREF
FLAG -2432 80 VCC
FLAG -2432 352 VCC
FLAG -2496 544 0
FLAG -2000 736 VCC
FLAG -1888 768 BG_REF
FLAG -2432 592 VCC
FLAG -2432 864 VCC
FLAG -176 272 VCC
FLAG -176 336 0
FLAG -464 352 0
FLAG -2432 528 0
FLAG -2432 928 0
FLAG -2000 800 0
FLAG -2208 432 0
FLAG -2048 432 VCC
FLAG -2432 16 0
FLAG -2432 416 0
FLAG -2000 288 0
FLAG -1600 256 0
FLAG -1360 96 0
FLAG -2208 944 0
FLAG -2048 944 VCC
FLAG 0 416 0
FLAG 912 0 VCC
FLAG 912 64 0
FLAG 800 128 0
FLAG 800 -32 VCC
FLAG 1024 32 AGND
FLAG -528 336 AGND
FLAG -224 288 AGND
FLAG -288 48 VCC
FLAG -288 112 0
FLAG -176 80 D_COMP_OUT
FLAG -352 96 A_COMP_OUT
FLAG 608 352 D_COMP_OUT
FLAG 704 464 D_COMP_OUT
FLAG 1424 64 BIT0
FLAG 1632 64 BIT5
FLAG 1632 256 BIT6
FLAG 1424 448 BIT2
FLAG 1632 448 BIT7
FLAG 1632 640 BIT8
FLAG 1424 640 BIT3
FLAG 1424 832 BIT4
FLAG 1632 832 BIT9
FLAG 1264 64 OUT0
FLAG 1424 256 BIT1
FLAG 1264 256 OUT1
FLAG 1264 448 OUT2
FLAG 1264 640 OUT3
FLAG 1264 832 OUT4
FLAG 1792 64 OUT5
FLAG 1792 256 OUT6
FLAG 1792 448 OUT7
FLAG 1792 640 OUT8
FLAG 1792 832 OUT9
FLAG 896 288 CTRL_PTAT
FLAG 816 496 CTRL_REF_N
FLAG 896 320 CTRL_REF_N
FLAG 992 320 REG_PRE
FLAG 1504 992 REG_PRE
FLAG 1552 896 CLK
SYMBOL res -608 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName INT_R
SYMATTR Value 59k
SYMBOL Digital\\dflop -1392 896 R0
SYMATTR InstName FF0
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\and 240 192 R0
WINDOW 0 13 100 Left 2
SYMATTR InstName A4
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Vt=0.01
SYMBOL cap -480 192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName INT_C
SYMATTR Value 10µ
SYMBOL voltage 368 16 M0
WINDOW 3 -89 52 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
WINDOW 0 -241 23 Left 2
SYMATTR Value 3.7V
SYMATTR InstName LI_ION_BATTERY
SYMBOL Digital\\dflop -1136 896 R0
SYMATTR InstName FF1
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop -880 896 R0
SYMATTR InstName FF2
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop -624 896 R0
SYMATTR InstName FF3
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL voltage 128 16 R0
WINDOW 3 24 44 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR Value PULSE(0 1.2 1m 25u 25u 0.5m 1m)
SYMATTR InstName CLK
SYMBOL Digital\\dflop -368 896 R0
SYMATTR InstName FF4
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop -112 896 R0
SYMATTR InstName FF5
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 144 896 R0
SYMATTR InstName FF6
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 400 896 R0
SYMATTR InstName FF7
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\and 672 304 R0
WINDOW 0 18 102 Left 2
SYMATTR InstName A1
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Vt=0.01
SYMBOL Digital\\and 240 304 R0
WINDOW 0 12 100 Left 2
SYMATTR InstName A2
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Vt=0.01
SYMBOL Digital\\and 672 192 R0
WINDOW 0 17 101 Left 2
SYMATTR InstName A3
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Vt=0.01
SYMBOL Digital\\dflop 416 448 R0
SYMATTR InstName FF20
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL voltage 240 16 R0
WINDOW 3 24 44 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
WINDOW 0 16 15 Left 2
SYMATTR Value PULSE(0 1.2 30m 0 0 10 10)
SYMATTR InstName START
SYMBOL Digital\\and 240 448 R0
SYMATTR InstName A6
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Vt=0.01
SYMBOL Digital\\and 768 416 R0
WINDOW 0 15 103 Left 2
SYMATTR InstName A5
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Vt=0.01
SYMBOL Digital\\dflop 656 896 R0
SYMATTR InstName FF8
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 912 896 R0
SYMATTR InstName FF9
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL npn -1392 336 M0
SYMATTR InstName Q1
SYMATTR Value BC547C
SYMBOL res -1440 -16 M0
SYMATTR InstName R1
SYMATTR Value 5.8k
SYMBOL res -1216 -16 R0
SYMATTR InstName R2
SYMATTR Value 58k
SYMBOL res -1216 192 R0
SYMATTR InstName R3
SYMATTR Value 6.1k
SYMBOL npn -1264 336 R0
SYMATTR InstName Q2
SYMATTR Value BC547C
SYMBOL Opamps\\UniversalOpamp2 -1328 96 M270
SYMATTR InstName VSC
SYMBOL sw -784 176 M180
WINDOW 0 42 54 Left 2
WINDOW 3 40 81 Left 2
SYMATTR InstName SW_PTAT
SYMATTR Value IDEAL_SW
SYMBOL sw -784 240 R0
WINDOW 0 43 46 Left 2
WINDOW 3 33 75 Left 2
SYMATTR InstName SW_REF
SYMATTR Value IDEAL_SW
SYMBOL res -2000 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_6
SYMATTR Value 10k
SYMBOL res -2160 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_4
SYMATTR Value 10k
SYMBOL res -2160 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_5
SYMATTR Value 10k
SYMBOL res -2144 272 R0
SYMATTR InstName RI_7
SYMATTR Value 10k
SYMBOL res -2512 160 R0
SYMATTR InstName RI_3
SYMATTR Value 100k
SYMBOL res -2000 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_12
SYMATTR Value 11K
SYMBOL res -2160 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_10
SYMATTR Value 9.1k
SYMBOL res -2160 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_11
SYMATTR Value 9.1k
SYMBOL res -2144 784 R0
SYMATTR InstName RI_13
SYMATTR Value 11k
SYMBOL res -2336 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_8
SYMATTR Value 20k
SYMBOL res -2512 672 R0
SYMATTR InstName R28
SYMATTR Value 100k
SYMBOL res -2336 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_9
SYMATTR Value 20k
SYMBOL res -2336 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_1
SYMATTR Value 2k
SYMBOL res -2336 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName RI_2
SYMATTR Value 2k
SYMBOL res -2032 416 R90
WINDOW 0 62 18 VBottom 2
WINDOW 3 -29 56 VTop 2
SYMATTR InstName R_AGND_2
SYMATTR Value 47k
SYMBOL res -2112 416 R90
WINDOW 0 61 87 VBottom 2
WINDOW 3 -29 62 VTop 2
SYMATTR InstName R_AGND_1
SYMATTR Value 47k
SYMBOL Opamps\\LT1677 -2000 192 R0
SYMATTR InstName AI_3
SYMBOL Opamps\\LT1677 -2432 320 R0
SYMATTR InstName AI_2
SYMBOL Opamps\\LT1677 -2432 112 M180
SYMATTR InstName AI_1
SYMBOL Opamps\\LT1677 -2000 704 R0
SYMATTR InstName AI_6
SYMBOL Opamps\\LT1677 -2432 832 R0
SYMATTR InstName AI_5
SYMBOL Opamps\\LT1677 -2432 624 M180
SYMATTR InstName AI_4
SYMBOL voltage -1600 160 R0
WINDOW 0 26 86 Left 2
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName START_SOURCE
SYMATTR Value PULSE(0 1 0 0.1m 0.1m 1m 1m 1)
SYMBOL diode -1552 176 R270
WINDOW 0 33 19 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName START_UP
SYMATTR Value 1N4148
SYMBOL Opamps\\LT1677 -464 256 R0
WINDOW 3 -53 124 Left 2
WINDOW 0 15 38 Left 2
SYMATTR InstName INT
SYMBOL Opamps\\LT1677 -176 240 R0
WINDOW 0 12 38 Left 2
WINDOW 3 -39 116 Left 2
SYMATTR InstName COMP
SYMBOL res -2032 928 R90
WINDOW 0 62 18 VBottom 2
WINDOW 3 -29 56 VTop 2
SYMATTR InstName R_AGND_3
SYMATTR Value 47k
SYMBOL res -2112 928 R90
WINDOW 0 61 87 VBottom 2
WINDOW 3 -29 62 VTop 2
SYMATTR InstName R_AGND_4
SYMATTR Value 47k
SYMBOL res 0 288 R90
WINDOW 0 53 61 VBottom 2
WINDOW 3 -24 44 VTop 2
SYMATTR InstName RD_1
SYMATTR Value 33k
SYMBOL res 16 416 R180
WINDOW 0 35 57 Left 2
WINDOW 3 36 33 Left 2
SYMATTR InstName RD_2
SYMATTR Value 15k
SYMBOL Opamps\\LT1677 912 -32 R0
WINDOW 0 13 30 Left 2
WINDOW 3 27 103 Left 2
SYMATTR InstName BUFFER
SYMBOL res 816 -48 M0
SYMATTR InstName R_AGND_X
SYMATTR Value 47k
SYMBOL res 816 32 M0
SYMATTR InstName R_AGND_Y
SYMATTR Value 47k
SYMBOL res -128 400 R90
WINDOW 0 60 55 VBottom 2
WINDOW 3 -27 52 VTop 2
SYMATTR InstName R_COMP_2
SYMATTR Value 100k
SYMBOL res -256 304 R90
WINDOW 0 63 57 VBottom 2
WINDOW 3 -25 80 VTop 2
SYMATTR InstName R_COMP_1
SYMATTR Value 500
SYMBOL Opamps\\LT1677 -288 16 R0
WINDOW 0 13 30 Left 2
WINDOW 3 27 103 Left 2
SYMATTR InstName BUFFER_A_TO_D
SYMBOL Digital\\dflop 1344 16 M0
SYMATTR InstName FF10
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1344 208 M0
SYMATTR InstName FF11
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1344 400 M0
SYMATTR InstName FF12
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1344 592 M0
SYMATTR InstName FF13
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1344 784 M0
SYMATTR InstName FF14
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1712 16 R0
SYMATTR InstName FF15
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1712 208 R0
SYMATTR InstName FF16
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1712 400 R0
SYMATTR InstName FF17
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1712 592 R0
SYMATTR InstName FF18
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\dflop 1712 784 R0
SYMATTR InstName FF19
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Td=5u
SYMBOL Digital\\xor 960 240 R0
SYMATTR InstName A7
SYMATTR Value2 Vhigh=1.2 Trise=1u Tfall=1u Vt=0.1 Td=50u
TEXT 872 1112 Left 2 ;10-BIT COUNTER
TEXT -512 584 Left 2 ;SWITCHS/INTEGRATOR/COMPARATOR
TEXT 760 592 Left 2 ;CONTROL UNIT
TEXT 808 -136 Left 2 !.step temp -40 80 20
TEXT -1344 584 Left 2 ;BANDGAP CIRCUIT
TEXT -2096 1088 Left 2 ;BANDGAP/ADC INTERFACE
TEXT -2608 -248 Left 2 ;Universidade Federal de Santa Catarina - UFSC\nEngenharia Eletrônica - EEL7303 - Circuitos Eletrônicos Analógicos\nProjeto - Sensor de Temperatura\nAndré Martins Pio de Mattos - 16103374\nGustavo Simas da Silva - 16101076
TEXT 808 -168 Left 2 !.tran 0 2.2 1m
TEXT 808 -200 Left 2 !.op
TEXT -936 552 Left 2 !.nodeset V(INT_OUT)=0 V(VREF)=0 V(BG_REF)=0 V(VSW)=0 V(COMP_OUT)=0
TEXT -1392 544 Left 2 !.nodeset V(CTAT)=0.05
TEXT -936 520 Left 2 !.model IDEAL_SW SW(Ron=1m Roff=100Meg Vt=0.5 Vh=0)
TEXT -88 -384 Left 2 ;Observations:\nAnalog Supply: Battery@3.7V\nDigital Supply: DVcc@1.2V\nBattery: Li-ion, nominal supply 3.7V, but it range from 3.3V to 4.2V\nAnalog Virtual Reference: Vcc/2\nRail-to-Rail: 0.3V under the Vcc supply\nTemperature range: -40 to +80\nADC_Resolution=10bits -> T2=1024 (levels)\nIdeal Precision: ~0.05ºC\nReal Precision: ~0.5ºC
TEXT 936 128 Left 2 ;SOURCES
TEXT -1664 -400 Left 2 ;Notes:\n@Nominal Supply: (Vcc=3.7V)\nIdeal values:\nT=-40°C -> T1=588; Vadc=694.02375mV ;Vreal=693.6886mV;Vref_bandgap=1.20864V;Er=0,0483%=>0,01932°C\nT=0°C -> T1=640; Vadc=750,035612mV ;Vreal=749.9158mV;Vref_bandgap=1.2005698V;Er=0,0159%=>0.015972°C\nT=40°C -> T1=694; Vadc=806.694891mV ;Vreal=806.6941mV;Vref_bandgap=1.1902818V;Er=9.805e-5 =>3.92217e-5°C\nT=80°C  -> T1=751; Vadc=863.479044mV ;Vreal=863,9253mV;Vref_bandgap=1.1773669V;Er=0,05168%=>0,041345°C\nReal values:\nErro max = 0,43% -> 0,2ºC (0->+40)\nErro max = 0,76% -> 0,3ºC (-40->+40)\nErro max = 1,24544%-> 0,5ºC (Máxima excursão)
TEXT 808 -232 Left 2 ;Simulation:
TEXT 1632 1112 Left 2 ;10-BIT REGISTER
TEXT 1168 -136 Left 2 !.four 1k V(INT_OUT)
RECTANGLE Normal -1664 1152 1104 688 2
RECTANGLE Normal -1664 -96 -1056 624 2
RECTANGLE Normal -2608 -96 -1728 1152 2
RECTANGLE Normal 32 624 -1008 -96 2
RECTANGLE Normal 64 192 1104 624 2
RECTANGLE Normal 1104 160 64 -96 2
RECTANGLE Normal 1888 1152 1168 -96 2
